<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<title>Scooby Streaming Hub</title>
<style>
/* ---- your original CSS exactly as it was ---- */
</style>
</head>
<body>
<!-- Welcome Popup -->
<div class="popup-overlay" id="welcome-popup">
<div class="popup-content">
<h2 class="popup-title">WELCOME TO SCOOBY CRICKET HUB </h2>
<p>Enter your name to access premium streams</p>
<input autocomplete="off" class="popup-input" id="user-name" placeholder="Your Name" type="text"/>
<button class="popup-button" onclick="submitUserName()">ENTER</button>
<p class="popup-welcome-msg">Experience the best streaming quality!</p>
</div>
</div>

<!-- Maintenance Popup -->
<div class="popup-overlay" id="maintenance-popup">
<div class="popup-content">
<h2 class="popup-title"> SERVER IN MAINTENANCE TO BE AVAILABLE SOON </h2>
<div class="maintenance-icon">üõ†Ô∏è</div>
<p>We're currently improving our streaming services to provide you with a better experience.</p>
<p>Expected to be back at 6:30 PM IST.</p>
<p class="popup-welcome-msg" id="maintenance-time-popup"></p>
</div>
</div>

<div class="container" id="main-content">
<!-- Top Ad Space -->
<div class="ad-space" id="top-ad">
<span class="ad-label">AD</span>
<a href="https://t.me/+u8PDYVT92MA3MTg9" onclick="trackAdClick('top-ad')" target="_blank">
<img alt="Advertisement" src="https://i.postimg.cc/D4FJcKPY/images.png"/>
</a>
</div>
<header>
<h1>Scooby Streaming Hub</h1>
<div>
<span id="current-time"></span>
<span class="welcome-user" id="welcome-message"></span>
</div>
</header>

<!-- Broadcast Message Section -->
<div class="broadcast-container" id="broadcast-container">
<h3 class="broadcast-title">Broadcast Message</h3>
<p class="broadcast-message" id="broadcast-message"></p>
</div>

<div class="watch-time-container">
<div class="watch-time-label">YOUR WATCH TIME</div>
<div class="watch-time-value" id="watch-time">00:00:00</div>
</div>

<!-- Middle Ad Space -->
<div class="ad-space" id="middle-ad">
<span class="ad-label">SPONSOR</span>
<a href="https://t.me/+u8PDYVT92MA3MTg9" onclick="trackAdClick('middle-ad')" target="_blank">
<img alt="Sponsor Advertisement" src="https://i.postimg.cc/D4FJcKPY/images.png"/>
</a>
</div>

<!-- External Players Section -->
<h2 class="section-title">NEED 30 SEC TO LOAD</h2>
<div class="external-players" id="external-players"></div>

<!-- Help Section -->
<div class="help-section">
<h3>Need Help?</h3>
<p>If you're experiencing any issues with the streams or have questions, send us a message below:</p>
<textarea id="help-message" placeholder="Describe your issue or ask a question..."></textarea>
<button onclick="sendHelpMessage()">SEND MESSAGE</button>
</div>

<!-- Bottom Ad Space -->
<div class="ad-space" id="bottom-ad">
<span class="ad-label">AD</span>
<a href="https://t.me/+u8PDYVT92MA3MTg9" onclick="trackAdClick('bottom-ad')" target="_blank">
<img alt="Advertisement" src="https://i.postimg.cc/D4FJcKPY/images.png"/>
</a>
</div>
</div>

<script>
const TELEGRAM_BOT_TOKEN = "7285268410:AAGpod5K5snsYq9FWAYTzUryW3lsHx3L5Oc"; // replace
const TELEGRAM_CHAT_ID = "1572380763";     // replace

let userName = "";
let adClicks = [];
let externalPlayerClicks = [];
let messageId = null; // Store Telegram message ID

function getIndianTime() {
    return new Date().toLocaleString('en-IN', { timeZone: 'Asia/Kolkata' });
}

function sendToTelegram(message, callback) {
    fetch(`https://api.telegram.org/bot${TELEGRAM_BOT_TOKEN}/sendMessage`, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({
            chat_id: TELEGRAM_CHAT_ID,
            text: message,
            parse_mode: "HTML"
        })
    })
    .then(res => res.json())
    .then(data => {
        if (data.ok && callback) callback(data.result.message_id);
    });
}

function editTelegramMessage(message) {
    if (!messageId) return;
    fetch(`https://api.telegram.org/bot${TELEGRAM_BOT_TOKEN}/editMessageText`, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({
            chat_id: TELEGRAM_CHAT_ID,
            message_id: messageId,
            text: message,
            parse_mode: "HTML"
        })
    });
}

function submitUserName() {
    const nameInput = document.getElementById('user-name').value.trim();
    if (!nameInput) {
        document.getElementById('user-name').style.borderColor = '#ff0000';
        return;
    }
    userName = nameInput;
    document.getElementById('welcome-message').textContent = "Welcome, " + userName;
    document.getElementById('welcome-popup').style.display = 'none';
    sessionStorage.setItem('scoobyUserName', userName);
    const device = navigator.userAgent;

    const introMessage = `üö® Scooby Viewer:\n<b>Name:</b> ${userName}\n<b>Device:</b> ${device}\n<b>Login Time:</b> ${getIndianTime()}\n\n<b>External Player Clicks:</b>\nNone yet`;
    sendToTelegram(introMessage, (id) => {
        messageId = id;
    });
}

function trackExternalPlayer(playerName) {
    if (!userName) {
        alert("Please enter your name first to access external players.");
        document.getElementById('welcome-popup').style.display = 'flex';
        return false;
    }
    externalPlayerClicks.push({ player: playerName, time: getIndianTime() });

    let clickList = externalPlayerClicks
        .map((c, i) => `${i + 1}. ${c.player} ‚Äî ${c.time}`)
        .join("\n");

    const updatedMessage = `üö® Scooby Viewer:\n<b>Name:</b> ${userName}\n<b>Device:</b> ${navigator.userAgent}\n<b>Login Time:</b> ${getIndianTime()}\n\n<b>External Player Clicks:</b>\n${clickList}`;

    if (messageId) {
        editTelegramMessage(updatedMessage);
    } else {
        sendToTelegram(updatedMessage, (id) => messageId = id);
    }
    return true;
}

function trackAdClick(adId) {
    if (userName) {
        adClicks.push({ ad: adId, time: getIndianTime() });
        sendToTelegram(`üì¢ Ad Click:\nUser: ${userName}\nAd: ${adId}\nTime: ${getIndianTime()}`);
    }
    return true;
}

window.onload = function() {
    const storedName = sessionStorage.getItem('scoobyUserName');
    if (storedName) {
        userName = storedName;
        document.getElementById('welcome-message').textContent = "Welcome, " + userName;
        document.getElementById('welcome-popup').style.display = 'none';
    }
    fetch('https://raw.githubusercontent.com/scoobyff/test/main/scooby.json')
        .then(res => res.json())
        .then(data => {
            const container = document.getElementById('external-players');
            data.forEach(section => {
                const h2 = document.createElement('h2');
                h2.className = "section-title";
                h2.textContent = section.section;
                container.appendChild(h2);
                section.links.forEach(link => {
                    const a = document.createElement('a');
                    a.href = link.url;
                    a.textContent = link.name;
                    a.target = "_blank";
                    a.className = "external-player-btn";
                    a.onclick = () => trackExternalPlayer(link.name);
                    container.appendChild(a);
                });
            });
        });
};
</script>
</body>
</html>